<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XtreamJson Stream Player</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/player.css" />
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.10"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.7/dist/hls.min.js"></script>
  </head>
  <body>
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    <div class="stream-container">
      <h2 class="mb-4">Streaming Player</h2>
      <h3 id="movieTitleDisplay" class="text-white mb-2"></h3>
      <div id="streamUrlDisplay" class="mb-2 text-info small d-none"></div>
      <video id="player" controls autoplay muted preload="auto"></video>

      <!-- Custom Video Controls -->
      <div id="customControls" class="custom-controls mt-3">
        <div class="controls-row">
          <button
            id="rewind30"
            class="btn btn-outline-light btn-sm"
            title="Rewind 30 seconds"
          >
            <span>⏪ 30s</span>
          </button>
          <button
            id="rewind10"
            class="btn btn-outline-light btn-sm"
            title="Rewind 10 seconds"
          >
            <span>⏪ 10s</span>
          </button>
          <button
            id="playPause"
            class="btn btn-outline-light btn-sm"
            title="Play/Pause (K)"
          >
            <span id="playPauseIcon">⏸</span>
          </button>
          <button
            id="forward10"
            class="btn btn-outline-light btn-sm"
            title="Forward 10 seconds"
          >
            <span>10s ⏩</span>
          </button>
          <button
            id="forward30"
            class="btn btn-outline-light btn-sm"
            title="Forward 30 seconds"
          >
            <span>30s ⏩</span>
          </button>
          <div id="timeDisplay" class="time-display ms-3">
            <span id="currentTime">0:00</span> / <span id="duration">0:00</span>
          </div>
        </div>
        <div class="keyboard-hints mt-2">
          <small class="text-muted">
            Keyboard: ← / J (back 10s) | → / L (forward 10s) | K (play/pause)
          </small>
        </div>
      </div>

      <div id="videoError" class="alert alert-danger mt-3 d-none"></div>
      <div id="vlcButtonContainer" class="mt-2"></div>
      <div id="vlcHelpText" class="text-secondary small mt-1"></div>
      <div class="mt-3">
        <a href="/" class="btn btn-secondary">Back to Home</a>
      </div>
    </div>

    <script src="/js/player.js"></script>
    <script>
      let injectedUrl = "[[${url}]]";
      let injectedTitle = "[[${title}]]";

      // Initialize player with server-side values
      initPlayer(injectedUrl, injectedTitle);
    </script>
    <script src="/js/navbar.js"></script>
  </body>
</html>
