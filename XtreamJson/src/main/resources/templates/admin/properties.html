<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Application Properties</title>
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="container mt-4">
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    <h2>Application Properties</h2>

    <!-- Main Content Container -->
    <div id="admin-content">
      <div class="mb-3">
        <form
          th:action="@{/admin/properties}"
          th:object="${currentProperties}"
          method="post"
          class="row g-3"
        >
          <input type="hidden" th:field="*{id}" aria-label="Record ID" />
          <div class="col-md-4">
            <label for="seriesInfoMaxInflight" class="form-label"
              >Series Info Max Inflight</label
            >
            <input
              type="number"
              class="form-control"
              id="seriesInfoMaxInflight"
              name="seriesInfoMaxInflight"
              th:field="*{seriesInfoMaxInflight}"
              min="1"
              required
            />
          </div>
          <div class="col-md-4">
            <label for="batchSize" class="form-label">Batch Size</label>
            <input
              type="number"
              class="form-control"
              id="batchSize"
              name="batchSize"
              th:field="*{batchSize}"
              min="1"
              required
            />
          </div>
          <div class="col-md-4">
            <label for="maxRetries" class="form-label">Max Retries</label>
            <input
              type="number"
              class="form-control"
              id="maxRetries"
              name="maxRetries"
              th:field="*{maxRetries}"
              min="0"
              required
            />
          </div>
          <div class="col-md-4">
            <label for="includedCountries" class="form-label"
              >Included Countries</label
            >
            <input
              type="text"
              class="form-control"
              id="includedCountries"
              name="includedCountries"
              th:field="*{includedCountries}"
              required
            />
          </div>
          <div class="col-md-4">
            <label for="excludedTitles" class="form-label"
              >Exclude from Playlist</label
            >
            <input
              type="text"
              class="form-control"
              id="excludedTitles"
              name="excludedTitles"
              th:field="*{excludedTitles}"
            />
          </div>

          <div
            class="col-12"
            th:if="${currentProperties.availablePrefixes != null && !currentProperties.availablePrefixes.isEmpty()}"
          >
            <label class="form-label"
              >Available Prefixes (Select to include)</label
            >
            <div class="dropdown">
              <button
                class="btn btn-secondary dropdown-toggle w-100 text-start"
                type="button"
                id="prefixDropdownButton"
                data-bs-toggle="dropdown"
                data-bs-auto-close="outside"
                aria-expanded="false"
              >
                Select Prefixes
              </button>
              <ul
                class="dropdown-menu w-100"
                aria-labelledby="prefixDropdownButton"
                style="max-height: 300px; overflow-y: auto"
              >
                <li th:each="prefix : ${currentProperties.availablePrefixes.split(',')}">
                  <div class="form-check ms-3">
                    <input
                      class="form-check-input prefix-checkbox"
                      type="checkbox"
                      th:id="${'pfx-' + prefix.trim()}"
                      th:value="${prefix.trim()}"
                      th:checked="${currentProperties.includedCountries != null && #arrays.contains(#strings.arraySplit(currentProperties.includedCountries, ','), prefix.trim())}"
                    />
                    <label
                      class="form-check-label w-100"
                      th:for="${'pfx-' + prefix.trim()}"
                      th:text="${prefix.trim()}"
                    ></label>
                  </div>
                </li>
              </ul>
            </div>
            <small class="text-muted"
              >Extracted from categories during last refresh.</small
            >
          </div>

          <div class="col-12 mt-3">
            <button type="submit" class="btn btn-primary">Save Settings</button>
          </div>
        </form>
      </div>

    <script src="/js/admin-properties.js"></script>
  </body>
</html>
